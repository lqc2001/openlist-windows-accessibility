# OpenList Windows管理工具

一个基于wxPython开发的OpenList服务器Windows管理工具，专为视障用户设计，提供完整无障碍支持。

## 📋 目录

- [版本信息](#-版本信息)
- [功能特性](#-功能特性)
- [系统要求](#-系统要求)
- [快速开始](#-快速开始)
- [项目结构](#-项目结构)
- [无障碍操作指南](#-无障碍操作指南)
- [用户界面详解](#-用户界面详解)
- [音频播放功能](#-音频播放功能)
- [日志系统](#-日志系统)
- [故障排除](#-故障排除)
- [开发信息](#-开发信息)
- [更新历史](#-更新历史)
- [安全特性](#-安全特性)
- [贡献指南](#-贡献指南)

## 🎯 版本信息

**当前版本：v1.1.6**
**更新日期：2025年10月24日**
**版本规范：语义化版本控制 (主版本.次版本.修订版本)**

## ✨ 功能特性

### 🔗 连接管理
- 支持多个OpenList服务器连接配置
- 安全的服务器密码存储（Fernet加密）
- 自动连接测试和验证
- 支持自签名HTTPS证书
- 快速服务器切换（Ctrl+Q，无确认对话框）

### 📁 智能文件管理
- 登录后直接进入文件管理界面
- 实时文件列表显示和刷新（F5）
- **智能目录导航**：进入目录自动选择第一项，返回上级精确恢复位置
- **位置记忆**：智能历史栈记录用户浏览位置，支持快速返回
- **焦点管理**：完整的焦点状态设置，确保屏幕阅读器正确朗读
- **友好错误处理**：API失败时显示具体错误信息，提供重试功能，无虚构数据
- 文件信息查看和路径复制
- 智能文件类型识别

### 🎵 音频播放
- 集成VLC音频播放器，支持音频文件直接播放
- 完整播放控制：播放/暂停、停止、上一个/下一个
- 快进快退、音量调节、倍速播放（0.5x-3.0x）
- 音频输出设备选择
- 播放状态实时显示

### 🎬 视频播放
- 视频文件使用独立播放器窗口
- 支持VLC支持的所有视频格式
- 完整的视频播放控制

### ♿ 无障碍支持
- 100%键盘可操作，专为屏幕阅读器优化
- 完整的Tab键导航和快捷键支持
- 控件名称和功能朗读
- 详细错误信息提示
- 快捷键语音提示

### ⌨️ 快捷键系统
- 全局快捷键支持
- 上下文相关的快捷键
- 统一的快捷键显示格式
- 快速服务器切换和文件操作

## 🖥️ 系统要求

### 基本要求
- **操作系统**：Windows 10/11
- **Python版本**：Python 3.8+
- **屏幕阅读器**：推荐NVDA或其他兼容读屏软件
- **VLC媒体播放器**：需要安装VLC 3.0+（用于音频/视频播放支持）

### 依赖包
```bash
pip install -r requirements.txt
```

主要依赖：
- `wxPython`：图形用户界面框架
- `requests`：HTTP客户端库
- `cryptography`：密码加密存储
- `python-vlc`：VLC媒体播放器绑定
- 其他标准库模块

## 🚀 快速开始

### 开发环境运行

1. **克隆项目**
   ```bash
   git clone <repository-url>
   cd openlist-windows
   ```

2. **安装依赖**
   ```bash
   pip install -r requirements.txt
   ```

3. **运行程序**
   ```bash
   python main.py
   ```

4. **打包为可执行文件**
   ```bash
   python build.py
   ```

### 基本使用流程

1. **启动程序**：运行`python main.py`，自动打开服务器选择对话框
2. **选择服务器**：在对话框中选择要连接的服务器
3. **登录服务器**：按`Alt+L`或点击连接按钮进行登录
4. **管理文件**：登录成功后直接进入文件管理界面
5. **智能文件夹导航**：
   - 双击文件夹进入子目录（自动选择第一项）
   - 按退格键返回上级目录（智能恢复之前的位置）
   - F5刷新当前目录（重新定位到第一项）
6. **切换服务器**：按`Ctrl+Q`随时切换到其他服务器（直接切换，无确认对话框）

### 智能导航使用示例

```
导航流程示例：
1. 在根目录选择第3项"文档"并进入 → 自动选择"文档"目录第一项
2. 在"文档"目录浏览到第10项"音乐"并进入 → 自动选择"音乐"目录第一项
3. 在"音乐"目录浏览一些文件
4. 按退格键返回 → 自动回到"文档"目录的第10项"音乐"
5. 再次按退格键返回 → 自动回到根目录的第3项"文档"
```

## 📁 项目结构

```
openlist-windows/
├── main.py                     # 主程序入口
├── requirements.txt            # 依赖包列表
├── build.py                   # 打包脚本
├── README.md                  # 项目说明文档（本文档）
├── CLAUDE.md                  # 开发团队配置指南
├── version_info.txt           # 版本信息文件
├── OpenListManager.spec       # PyInstaller配置
├── config/                    # 配置文件目录
├── logs/                      # 日志文件目录（启用时）
├── cache/                     # 缓存文件目录
├── tmp/                       # 临时文件目录
└── src/                       # 源代码目录
    ├── ui/                    # 用户界面模块
    │   ├── main_frame.py           # 主窗口界面
    │   ├── file_manager_window.py  # 文件管理窗口
    │   ├── server_select_dialog.py # 服务器选择对话框
    │   ├── server_dialog.py        # 服务器配置对话框
    │   ├── audio_player_controller.py # 音频播放控制器
    │   └── media_player_window.py  # 媒体播放器窗口
    ├── core/                  # 核心功能模块
    │   ├── config_manager.py      # 配置管理器
    │   ├── logger.py              # 日志系统
    │   └── version.py             # 版本信息管理
    ├── api/                   # API客户端模块
    │   └── openlist_client.py     # OpenList客户端
    ├── media/                 # 媒体播放模块
    │   ├── audio_player.py        # 音频播放器核心
    │   ├── media_player_core.py   # 媒体播放器核心
    │   ├── vlc_loader.py          # VLC库加载器
    │   ├── file_detector.py       # 媒体文件检测器
    │   └── playlist_manager.py    # 播放列表管理
    └── accessibility/          # 无障碍功能模块
```

## ⌨️ 无障碍操作指南

### 基本导航
- **Tab键**：在控件间正向切换
- **Shift+Tab**：在控件间反向切换
- **方向键**：在列表中选择项目
- **空格键**：激活按钮或播放/暂停音频
- **回车键**：确认操作或打开文件/文件夹
- **Esc键**：取消当前操作或关闭对话框

### 快捷键参考

#### 服务器选择对话框
- **Alt+L**：连接到选中的服务器
- **Alt+A**：添加新服务器
- **Alt+E**：编辑选中的服务器
- **Alt+D**：删除选中的服务器
- **F1**：显示关于信息
- **Alt+F4**：退出程序

#### 文件管理窗口
- **Ctrl+Q**：切换到其他服务器
- **F5**：刷新文件列表（重新定位到第一项）
- **Ctrl+A**：全选文件
- **Ctrl+I**：反向选择
- **Ctrl+C**：复制文件名
- **Ctrl+Shift+C**：复制文件路径
- **Enter**：打开文件/文件夹
- **Backspace**：返回上级目录（智能恢复之前的位置）
- **Alt+F4**：退出程序

#### 智能导航特性
- **自动选择**：进入新目录后自动选择并聚焦第一项
- **位置记忆**：按退格键返回时精确恢复到之前浏览的位置
- **空目录处理**：空目录时焦点给列表控件，屏幕阅读器正确反馈
- **刷新重定位**：F5刷新后自动定位到目录开头

#### 音频播放快捷键
- **Ctrl+Home**：播放/暂停音频
- **Ctrl+End**：停止播放
- **Ctrl+PageUp**：播放上一个音频文件
- **Ctrl+PageDown**：播放下一个音频文件
- **Ctrl+Left**：快退5秒
- **Ctrl+Right**：快进5秒
- **Ctrl+Up**：音量增加
- **Ctrl+Down**：音量减少
- **空格键**：播放/暂停（仅在文件列表有焦点时生效）

### 无障碍功能
- ✅ 屏幕阅读器完整支持
- ✅ 控件名称和功能朗读
- ✅ 操作状态文字反馈
- ✅ 详细错误信息提示
- ✅ 快捷键语音提示
- ✅ 焦点管理和导航优化

## 🖼️ 用户界面详解

### 服务器选择对话框
- **服务器列表**：显示所有已配置的服务器
- **连接按钮**：连接到选中的服务器（Alt+L）
- **添加按钮**：添加新的服务器配置（Alt+A）
- **编辑按钮**：编辑选中的服务器配置（Alt+E）
- **删除按钮**：删除选中的服务器配置（Alt+D）

### 服务器配置对话框
- **服务器名称**：为服务器配置一个易识别的名称
- **服务器地址**：输入OpenList服务器的URL地址
- **用户名**：登录用户名
- **密码**：登录密码（安全加密存储）
- **连接测试**：测试服务器连接是否正常

### 文件管理窗口
- **文件列表**：显示当前目录的文件和文件夹，支持智能导航
- **地址栏**：显示当前路径（只读）
- **状态栏**：5字段状态栏显示文件数量、选择状态及音频播放信息
- **播放菜单**：音频播放控制菜单
- **文件菜单**：文件操作菜单

#### 智能导航系统
- **历史栈管理**：自动记录目录浏览历史，支持快速位置恢复
- **路径验证**：智能验证历史记录的有效性，确保数据一致性
- **焦点同步**：确保视觉选择、键盘焦点和屏幕阅读器朗读完全同步

### 媒体播放器窗口
- **播放控制**：播放/暂停、停止、上一个/下一个
- **进度条**：显示播放进度，支持拖动定位
- **音量控制**：音量调节和静音
- **倍速控制**：播放速度调节（0.5x-3.0x）
- **设备选择**：音频输出设备选择

## 🎵 音频播放功能

### 支持的媒体格式
- **音频格式**：MP3, WAV, FLAC, OGG, AAC, M4A等VLC支持的所有音频格式
- **视频格式**：MP4, AVI, MKV, MOV等VLC支持的所有视频格式

### 播放控制方式
1. **菜单控制**：通过"播放(&P)"菜单控制所有播放功能
2. **快捷键控制**：使用全局快捷键快速控制播放
3. **空格键控制**：在文件列表中选择音频文件后按空格键播放
4. **状态栏显示**：5字段状态栏实时显示播放状态、时间、进度、音量和倍速

### 播放特性
- **智能播放策略**：音频文件在文件管理器中直接播放，视频文件使用独立播放器窗口
- **自动播放列表**：自动识别当前目录的音频文件，支持上一个/下一个导航
- **设备选择**：支持选择不同的音频输出设备
- **倍速播放**：支持0.5x到3.0x的倍速播放
- **音量控制**：支持音量调节和静音功能
- **进度控制**：支持快进快退和拖动定位

### 使用方法
1. **播放音频文件**：
   - 在文件列表中选择音频文件
   - 按空格键或使用播放菜单的"播放/暂停"
   - 或双击音频文件直接播放

2. **播放控制**：
   - 使用播放菜单或快捷键控制播放
   - 快进快退、调节音量、切换倍速
   - 上一个/下一个文件导航

3. **查看播放状态**：
   - 状态栏显示当前播放状态
   - 显示播放时间、进度、音量和倍速信息

## 📝 日志系统

OpenList 采用静默日志设计理念，默认情况下不产生任何日志输出，确保程序安静运行并避免不必要的性能开销。

### 快速开始

#### 默认状态（推荐）
```bash
# 不设置任何环境变量
# 程序将完全静默运行，不产生日志文件
```

#### 启用完整调试日志
```bash
# Windows 命令行
setx OPENLIST_LOG_LEVEL on
setx OPENLIST_CONSOLE_LEVEL DEBUG

# 重启程序生效
```

#### 临时启用日志（当前会话）
```bash
# Windows 命令行（临时）
set OPENLIST_LOG_LEVEL=on
set OPENLIST_CONSOLE_LEVEL=DEBUG

# 重启程序生效，关闭命令行后失效
```

### 环境变量配置

#### OPENLIST_LOG_LEVEL
控制文件日志的输出级别：

| 值 | 说明 | 输出内容 |
|---|---|---|
| *(未设置)* | 静默模式 | 无日志输出 |
| `on` | 完整调试 | DEBUG 及以上所有级别 |
| `DEBUG` | 调试模式 | DEBUG 及以上所有级别 |
| `INFO` | 信息模式 | INFO 及以上所有级别 |
| `WARNING` | 警告模式 | WARNING 及以上所有级别 |
| `ERROR` | 错误模式 | ERROR 及以上所有级别 |
| `CRITICAL` | 严重错误 | 仅 CRITICAL 级别 |
| `off` | 关闭日志 | 无日志输出 |

#### OPENLIST_CONSOLE_LEVEL
独立控制控制台日志输出级别，支持与文件日志相同的级别设置。如果不设置，控制台不会输出日志。

### 使用场景

#### 日常使用
```bash
# 保持默认设置，程序静默运行
# 无需配置，获得最佳性能
```

#### 开发调试
```bash
setx OPENLIST_LOG_LEVEL on
setx OPENLIST_CONSOLE_LEVEL DEBUG
# 获取最详细的调试信息，包含函数调用栈
```

#### 故障排除
```bash
setx OPENLIST_LOG_LEVEL WARNING
setx OPENLIST_CONSOLE_LEVEL ERROR
# 只关注警告和错误信息，便于快速定位问题
```

#### 性能监控
```bash
setx OPENLIST_LOG_LEVEL INFO
# 记录程序运行状态，不影响主要性能
```

### 日志文件管理

#### 文件位置
```
logs/
├── debug_20251023.log    # 当天日志
├── debug_20251022.log    # 前一天日志
└── debug_20251021.log.1  # 历史备份（轮转）
```

#### 文件命名规则
- 格式：`debug_YYYYMMDD.log`
- 按日期自动分割
- 支持日志轮转：单个文件最大 10MB，保留 5 个备份

#### 日志格式
```
2025-10-23 14:30:15 - OpenListManager - DEBUG - function_name:123 - 这是一条调试信息
2025-10-23 14:30:16 - OpenListManager - INFO - function_name:124 - 程序正常运行
```

格式说明：
- `时间戳` - 精确到秒的时间信息
- `OpenListManager` - 日志记录器名称
- `级别` - DEBUG/INFO/WARNING/ERROR/CRITICAL
- `function_name:行号` - 代码位置信息
- `消息内容` - 具体的日志信息

### 常见问题

#### Q: 为什么程序没有产生日志文件？
**A**: 这是正常行为。OpenList 默认采用静默模式，需要手动设置环境变量才能启用日志。

#### Q: 设置了环境变量但没有生效？
**A**: 环境变量设置后需要重启程序才能生效。使用 `setx` 设置的环境变量在新的命令行窗口中生效。

#### Q: 如何彻底关闭日志输出？
**A**:
```bash
setx OPENLIST_LOG_LEVEL off
# 或删除环境变量
setx OPENLIST_LOG_LEVEL ""
```

#### Q: 日志文件太大怎么办？
**A**: 系统自动处理日志轮转，单个文件超过 10MB 会自动创建新文件，保留最近 5 个文件。

#### Q: 如何只看错误信息？
**A**:
```bash
setx OPENLIST_LOG_LEVEL ERROR
setx OPENLIST_CONSOLE_LEVEL ERROR
```

## 🔧 故障排除

### 常见问题

#### 程序无法启动
1. **检查Python版本**：确保使用Python 3.8+
2. **安装依赖**：运行 `pip install -r requirements.txt`
3. **检查VLC安装**：确保安装了VLC 3.0+
4. **查看错误信息**：启用日志系统查看详细错误

#### 连接服务器失败
1. **检查网络连接**：确保网络连接正常
2. **验证服务器地址**：检查服务器URL是否正确
3. **检查登录凭据**：确认用户名和密码正确
4. **SSL证书问题**：尝试忽略SSL证书验证（仅用于测试）

#### 音频播放问题
1. **检查VLC安装**：确保VLC正确安装并可正常使用
2. **检查音频文件**：确认文件格式受支持
3. **检查音频设备**：确保音频设备正常工作
4. **查看日志**：启用日志查看详细错误信息

#### 文件列表不显示
1. **刷新列表**：按F5刷新文件列表
2. **检查权限**：确认有访问目录的权限
3. **重新连接**：尝试重新连接服务器
4. **查看错误对话框**：注意错误信息中的具体失败原因
5. **使用重试功能**：点击错误对话框中的"重试"按钮

#### 频繁出现错误对话框
1. **检查网络稳定性**：确保网络连接稳定
2. **验证服务器状态**：确认OpenList服务器正常运行
3. **检查服务器配置**：确保API接口配置正确
4. **启用日志系统**：设置环境变量`OPENLIST_LOG_LEVEL=on`查看详细错误

### 性能优化

#### 提高响应速度
- 保持日志系统关闭状态
- 定期清理缓存文件
- 避免同时打开过多文件

#### 内存使用优化
- 关闭不需要的播放器窗口
- 定期重启程序释放内存
- 避免在单一目录中存放过多文件

## 🛡️ 安全特性

### 密码安全
- 密码采用Fernet对称加密存储
- 加密密钥基于系统信息生成
- 本地存储，数据安全可控

### 网络安全
- 支持HTTPS连接和SSL证书验证
- 可选的SSL证书忽略（用于自签名证书）
- 安全的JWT令牌处理

### 数据保护
- 配置文件本地加密存储
- 敏感信息内存加密
- 安全的临时文件处理

## 📊 开发信息

### 技术架构
- **前端框架**：wxPython 4.1+
- **网络库**：requests 2.25+
- **加密库**：cryptography 3.4+
- **媒体引擎**：python-vlc 3.0+
- **日志系统**：Python标准logging模块

### 代码规范
- **命名规范**：PascalCase（类）、snake_case（函数和变量）、UPPER_SNAKE_CASE（常量）
- **文档规范**：所有公共方法都有docstring
- **日志规范**：使用统一的日志系统，禁用print语句
- **无障碍规范**：所有控件设置适当的名称和帮助文本

### 测试
```bash
# 测试程序启动
python test_startup.py

# 测试Tab导航
python test_tab_navigation.py

# 测试无障碍功能
python test_accessibility.py

# 测试音频播放
python test_audio_player.py

# 测试日志系统
python demo_logger_switch.py
```

### 构建和部署
```bash
# 开发环境运行
python main.py

# 打包为可执行文件
python build.py

# 检查依赖
pip freeze > requirements.txt
```

## 📈 更新历史

### v1.1.4 (2025-10-23) - 智能目录导航 🧭
- 🧭 **智能目录导航**：进入目录后自动选择第一项，提供流畅的浏览体验
- 📍 **位置记忆系统**：智能历史栈记录浏览位置，返回上级时精确恢复
- 🎯 **焦点管理优化**：完整的焦点状态设置，确保屏幕阅读器正确朗读
- 🔄 **路径验证机制**：验证历史记录有效性，确保数据一致性
- ⌨️ **刷新重定位**：F5刷新后自动定位到目录开头
- 🎵 **播放连续性**：目录切换不影响正在播放的音频
- 📝 **文档更新**：更新开发指南和用户文档

### v1.1.3 (2025-10-23) - 静默日志系统 🤫
- 📝 **静默日志设计**：默认关闭日志输出，程序安静运行
- 🎛️ **环境变量控制**：通过OPENLIST_LOG_LEVEL环境变量灵活控制日志
- 🔧 **按需调试**：需要时可启用完整DEBUG级别日志
- 📊 **性能优化**：静默模式下零性能开销
- 📖 **文档整合**：整合所有用户文档到单一README文件

### v1.1.2 (2025-10-21) - 音频设备增强 🎧
- 🔊 **音频设备持久化**：记住选择的音频输出设备
- 🔄 **设备重新应用**：停止播放后保持设备选择
- 🎛️ **播放状态同步**：改进播放状态管理和UI同步
- ⏯️ **播放控制优化**：标准化暂停/恢复逻辑

### v1.1.1 (2025-10-19) - 播放体验优化 🎵
- 🎯 **播放列表同步**：播放状态与列表选择同步
- ⏮️ **轨道切换改进**：优化上一个/下一个轨道切换
- 🎛️ **状态反馈增强**：改进播放状态反馈机制
- 🔧 **错误处理优化**：更好的播放错误处理和恢复

### v1.1.0 (2025-10-17) - 音频播放功能版 ✨
- 🎵 **新增音频播放功能**：集成VLC音频播放器，支持音频文件直接播放
- 🎛️ **完整播放控制**：播放菜单、快捷键、状态栏一体化播放控制
- 🎧 **音频设备选择**：支持选择不同的音频输出设备
- ⏯️ **播放列表导航**：自动播放列表，支持上一个/下一个文件导航
- 🔄 **播放功能**：快进快退、音量调节、倍速播放（0.5x-3.0x）
- 📊 **5字段状态栏**：显示播放状态、时间、进度、音量、倍速
- 🎬 **视频播放支持**：视频文件继续使用独立播放器窗口
- ⌨️ **空格键控制**：在文件列表中有焦点时按空格键播放/暂停
- 🎯 **智能播放策略**：音频文件集成播放，视频文件独立窗口播放

### v1.0.0 (2025-10-16) - 稳定版发布
- 重构版本管理系统，采用语义化版本控制
- 修复版权信息显示错误（copyright_end_year问题）
- 改进API客户端错误处理，解决HTML响应问题
- 优化连接测试的容错性
- 完善版本管理工具函数
- 整理项目文档和代码结构

### v0.4.0 (2025-10-16) - 功能完善版
- 实现文件夹导航功能（双击进入，退格键返回）
- 修复文件列表API接口和JWT认证问题
- 简化服务器选择界面，删除多余按钮
- 优化服务器切换流程，去除确认对话框
- 修复Tab导航无法切换到按钮的问题
- 修正退格键返回上级目录功能

### v0.3.0 (2025-10-15) - 问题修复版
- 修复添加服务器功能不保存数据的问题
- 修复连接按钮无反应的问题
- 优化错误提示和状态反馈机制
- 统一快捷键显示格式
- 清理无用的测试文件和代码

### v0.2.0 (2025-10-14) - 界面优化版
- 简化无障碍架构实现
- 修复Tab导航问题
- 优化用户界面设计
- 完善文档系统

### v0.1.0 (2025-10-13) - 初始版
- 初始版本发布
- 基本服务器管理功能
- 完整无障碍支持

## 🤝 贡献指南

### 开发环境设置
1. **Fork项目**：在GitHub上fork项目到个人账户
2. **克隆代码**：`git clone <your-fork-url>`
3. **创建分支**：`git checkout -b feature/your-feature-name`
4. **安装依赖**：`pip install -r requirements.txt`

### 代码规范
- 遵循PEP 8代码风格
- 使用有意义的变量和函数名
- 添加适当的注释和文档字符串
- 确保无障碍功能正常工作

### 提交规范
- 使用清晰的提交信息
- 一个提交只做一件事
- 提交前运行测试确保功能正常
- 更新相关文档

### 测试要求
- 新功能必须包含相应测试
- 确保现有测试通过
- 测试无障碍功能
- 手动验证核心功能

## 📄 许可证

MIT License

## 📞 获取帮助

如遇到问题，请按以下步骤获取帮助：

1. **查看文档**：首先查看本文档的相关章节
2. **检查日志**：如遇问题，启用日志系统查看详细信息
3. **搜索已知问题**：查看项目的Issues页面
4. **提交Issue**：如问题未解决，请创建新的Issue并提供详细信息
5. **联系支持**：通过项目主页联系维护团队

---

*专为视障用户设计的OpenList服务器管理工具*

## 🎉 致谢

感谢所有为这个项目做出贡献的开发者和用户，特别是：

- 为无障碍功能提供反馈的用户
- 参与测试和bug报告的贡献者
- 提供建议和改进意见的社区成员
- 开源项目的维护者和贡献者

您的支持让这个工具变得更好！